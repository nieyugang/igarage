<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="robots" content="all,follow">
    <link rel="stylesheet" href="../../vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../vendor/layui/css/layui.css">
    <link rel="stylesheet" href="" id="layui-theme-stylesheet">

</head>

<body>
    <!-- 主体内容区 -->
    <div class="content-inner" style=" z-index: 0;width: 98%">
        <!-- ===================================================== -->
        <!-- 请在此处编写你的业务代码 -->
        <!-- ===================================================== -->
        <fieldset class="layui-elem-field layui-field-title">
            <legend>角色列表</legend>
            <div class="layui-field-box">
                <div class="work-area" style="margin-top: 10px;margin-left: 10px">
                    <div class="layui-form layui-card-header layuiadmin-card-header-auto">
                        <form class="layui-form caller-seach" action="" style="position: relative;
                            padding-bottom: 40px;">
                            <i class="layui-icon layui-icon-search caller-seach-icon caller-icon" style=" font-size: 18px;
                                position: absolute;
                                top: -3px;
                                left: 5px;"></i>
                            <input type="text" name="title" required="" lay-verify="required" placeholder="请输入角色名称进行查询"
                                autocomplete="off" class="layui-input caller-pl32" style="padding: 0 32px;">
                            <i class="layui-icon layui-icon-close caller-dump-icon caller-icon" style="    font-size: 18px;
                                position: absolute;
                                top: -3px;left: 98%;"></i>
                        </form>
                    </div>
                    <!-- 定义角色授权按钮 -->
                    <script type="text/html" id="authorizationbar">
                        <div class="layui-btn-group">
                            <button type="button" class="layui-btn layui-btn-xs" id = "roleAuthorization"  lay-event="roleAuthorization" >菜单授权</button>
                        </div>
                     </script>
                    <table class="layui-hide" id="role" lay-filter="role"></table>
                </div>
            </div>
        </fieldset>
    </div>

    <!-- js插件 -->
    <script src="../../vendor/jquery/jquery.min.js"></script>
    <script src="../../vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="../../vendor/layui/layui.js"></script>
    <script src="../../js/front.js"></script>

    <script>
        var baseUrl = "/hqigservice";
        layui.use('table', function () {
            var table = layui.table;
            var $ = layui.jquery;
            var layer = layui.layer;
            // 表格初始化
            table.render({
                title: '基础-用户信息表',
                elem: '#role',
                height: 'full-150',
                method: 'POST',
                contentType: 'application/json',
                url: baseUrl + '/getRoleList.json',
                where: {
                    "userInfo": {
                        "userId": 1,
                        "userName": "许明",
                        "sessionId": "123456"
                    },
                    "pageNo": 1,
                    "pageSize": 20
                },
                parseData: function (res) {
                    return {
                        code: 0,
                        msg: "",
                        count: res.roleList.length,
                        data: res.roleList
                    };
                },
                toolbar: 'default',
                page: true,
                cols: [[
                    { type: 'radio', fixed: 'left' },
                    { type: 'numbers', title: '序号', align: 'center' },
                    { field: 'roleId', title: '角色ID', sort: false, align: 'center', hide: true },
                    { field: 'roleName', title: '角色名称', sort: false, align: 'center' },
                    { field: 'authorization', title: '授权', sort: false, align: 'center', toolbar: '#authorizationbar' }
                    // {
                    //     fixed: 'right', title: '操作', width: 165, align: 'center', toolbar: '#bar'
                    // },
                ]]
            });

            // 监听头部工具栏事件
            table.on('toolbar(role)', function (obj) {
                var checkStatus = table.checkStatus(obj.config.id);
                var data = checkStatus.data; //获取选中的数据
                var layEvet = obj.event;
                switch (layEvet) {
                    case 'add':
                        layer.open({
                            type: 2,
                            title: false,
                            anim: 1,
                            area: ['800px', '300px'],
                            content: './roleAdd.html',
                            end: function () {
                                table.reload('role');
                            }
                        });
                        break;
                    case 'update':
                        if (data.length === 0) {
                            layer.msg('请选择一行');
                        } else if (data.length > 1) {
                            layer.msg('只能同时编辑一个', function () { });
                        } else {
                            var content = './roleEdit.html?roleInfo=' + encodeURIComponent(JSON.stringify(checkStatus.data[0]));
                            layer.open({
                                type: 2,
                                title: false,
                                anim: 1,
                                area: ['800px', '300px'],
                                content: content,
                                end: function () {
                                    table.reload('role');
                                    //  location.reload();
                                    //  table.reload();
                                }
                            });

                        }
                        break;
                    case 'delete':
                        if (data.length === 0) {
                            layer.msg('请选择一行');
                        } else {
                            var roleId = checkStatus.data[0].roleId;
                            layer.confirm('确定删除吗？', function (index) {
                                $.ajax({
                                    url: baseUrl + '/roleDelete.json',
                                    type: 'POST',
                                    data: JSON.stringify({
                                        "userInfo": {
                                            "userId": 1,
                                            "userName": "许明",
                                            "sessionId": "123456"
                                        },
                                        "roleId": roleId
                                    }),
                                    contentType: "application/json",
                                    dataType: 'json',
                                    async: true,
                                    success: function (res) {
                                        if (res.resFlag == "N") {
                                            layer.msg('操作成功', { icon: 1 });
                                            setTimeout(function () {
                                                table.reload('role');
                                            }, 2000);

                                        } else {
                                            layer.msg(res.resFlag, { icon: 2 });
                                        }
                                    },
                                    error: function () {
                                        layer.msg(res.resFlag, { icon: 2 });
                                    }
                                });
                            });
                        }
                        break;
                };
            });

            //监听行工具事件
            table.on('tool(role)', function (obj) {
                var data = obj.data; //获得当前行数据
                var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
                switch (layEvent) {
                    case 'roleAuthorization': // 角色授权
                        layer.open({
                            type: 2,
                            title: false,
                            anim: 1,
                            area: ['800px', '400px'],
                            content: './roleAuthorization.html?roleId=' + data.roleId+"&roleName="+ encodeURIComponent(data.roleName),
                            end: function () {
                                table.reload('role');
                            }
                        });
                        break;
                };
            });
            // // 监听角色按钮 roleAuthorization.html
            // $(document).on('click', '#roleAuthorization', function () {
            //     layer.open({
            //         type: 2,
            //         title: false,
            //         anim: 1,
            //         area: ['800px', '300px'],
            //         content: './roleAuthorization.html',
            //         end: function () {
            //             table.reload('role');
            //         }
            //     });
            // });
        });
    </script>
</body>

</html>