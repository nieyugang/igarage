<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
  <link rel="stylesheet" href="../../css/formSelects-v4.css">
</head>

<body>
  <div class="example">
    <div class="layui-input-block">
      <select name="orgId" xm-select="select_orgid" lay-verify="required" xm-select-radio="">
      </select>
    </div>
    <div class="layui-input-block">
      <select name="roleId" xm-select="select_role" lay-verify="required" xm-select-radio="">
      </select>
    </div>
  </div>
  <script src="../../vendor/jquery/jquery.js"></script>
  <script src="../../vendor/layui/layui.js"></script>
  <script src="../../vendor/layui/lay/modules/formSelects-v4.js"></script>
  <script>
    var backServiceUrl = "/hqigservice";
    //加载组织树
    var nodes = [];
    $.ajax({
      url: backServiceUrl + '/getOrgTree.json',
      //url: 'http://192.168.1.196:8088/hqigservice//getOrgTree.json',
      type: 'POST',
      data: JSON.stringify({
        "userInfo": userInfo,
        "orgId":  userInfo.orgId
      }),
      contentType: "application/json",
      dataType: 'json',
      async: true,
      success: function (res) {
        //处理返回数据
        var orgTreeInfo = res.orgTreeInfo;// 顶层节点
        var childrens;
        childrens = getTreeJson(orgTreeInfo.childOrgList);
        var root_node = {
          "value": orgTreeInfo.orgId,
          "name": orgTreeInfo.orgName,
          "selected": "",
          "disabled": "",
          "children": childrens
        };// 存放tree数据
        nodes.push(root_node);
        layui.formSelects.data('select_orgid', 'local', {
          arr: nodes
        });
      },
      error: function () {

      }
    });


    //获取角色data
    $.ajax({
      url: backServiceUrl + '/getRoleList.json',
      type: 'POST',
      contentType: 'application/json',
      dataType: 'json',
      data: JSON.stringify({
        "userInfo": userInfo,
      }),
      success: function (res) {
        var roleList = res.roleList;
        var data = [];
        for (var i in roleList) {
          if (roleList.hasOwnProperty(i)) {
            var element = roleList[i];
            var name = element.roleName;
            var value = element.roleId;
            var selected = "";
            var disabled = "";
            var role = {
              "name": name,
              "value": value,
              "selected": selected,
              "disabled": disabled
            };
            data.push(role);
          }
        }
        // 设置select_role 的值  formSelects.value('select_role', [2, 4]);  获取：formSelects.value('select_role'); // [{"name":"上海","val":"2"},{"name":"深圳","val":"4"}]
        layui.formSelects.data('select_role', 'local', {
          arr: data
        });
      },
      error: function () {
        layer.msg("与服务器通信异常！");
      }
    });

    // js 递归返回的组织树
    function getTreeJson(childrens) {
      var child_node = [];
      for (var i in childrens) {
        var node = {
          "value": childrens[i].orgId,
          "name": childrens[i].orgName,
          "selected": "",
          "disabled": ""
        };// 存放tree数据
        var childrens_node = childrens[i].childOrgList;
        if (childrens_node != 0) {
          var son = getTreeJson(childrens_node);
          node.children = son;
        }
        child_node.push(node);
      }
      return child_node;
    };
  </script>

</body>

</html>