<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="robots" content="all,follow">
    <link rel="stylesheet" href="../../vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../vendor/layui/css/layui.css">
    <link rel="stylesheet" href="" id="layui-theme-stylesheet">
    <style>
        #maintainInfoDetails div {
            font-size: 12px;
        }

        #parkingInfo ul {
            list-style: none;
            line-height: 50px;
        }

        #parkingInfo li {
            border-bottom: 1px solid #bbbbbb;
            text-align: center;
            height: 90px;
            padding-top: 14px;
        }

        #parkingInfo .active {
            background-color: #00a0e9;
            color: #fff;
            text-align: center;
        }

        #parkingInfo li span {
            float: right;
        }

        .anchorBL {
            display: none;
        }
    </style>
</head>

<body>
<h1>车库系统 / 日常管理</h1>
<div class="work-area" style="margin-top: 10px;margin-left: 10px;height: 100%">
    <!-- ===================================================== -->
    <!-- 请在此处编写你的业务代码 -->
    <!-- ===================================================== -->
    <div class="row" style="background-color: white;">
        <div class="layui-col-md2" style="border-right:2px solid #f2f2f2;height: 100%;">
            <div style="margin-top: 20%; height: 100%">
                <label
                        style="font-size: 14px; padding: 0 15px; display: inline; margin: 0 13px;border-left: 5px solid #28a745;">组织机构</label>
                <div id="orgTree" class="demo-tree"></div>
            </div>
        </div>
        <div class="layui-col-md10">
            <div style="margin-top: 2%;" class="row">
                <div class="layui-col-md7" id="maintainMapInfo"
                     style="border: 1px solid #848d92;min-height: 550px; min-width: 97%">
                    <div class="layui-tab layui-tab-brief">
                        <ul class="layui-tab-title">
                            <li class="layui-this">地图</li>
                            <li>工程图</li>
                        </ul>
                        <div class="layui-tab-content">
                            <div class="layui-tab-item layui-show">
                                <div id="allmap" style="height: 450px"></div>
                            </div>
                            <div class="layui-tab-item">
                                <div class="layui-form-item" style="text-align: center">
                                    <img id="maintainImg" src="">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-col-md4" id="maintainInfoDetails"
                     style="border: 1px solid #848d92;min-height: 550px; margin-left: 2%; max-width: 30%; display: none">
                    <div class="layui-tab layui-tab-brief" id="showMaintain">
                        <div class="layui-tab layui-tab-brief">
                            <ul class="layui-tab-title">
                                <li class="layui-this">信息描述</li>
                                <li>车位信息</li>
                                <li>设备统计</li>
                                <li>控制面板</li>
                            </ul>
                            <div class="layui-tab-content">
                                <div class="layui-tab-item layui-show" id="maintainInfo">
                                    <div class="layui-form-item" style="margin-top: 10px; margin-bottom: 0px;">
                                        <label class="layui-form-label-right-col-3">车库名称</label>
                                        <label class="layui-form-label-left-col-5" id="garageNameLabel"></label>
                                    </div>
                                    <div class="layui-form-item" style="margin-bottom: 0px;">
                                        <label class="layui-form-label-right-col-3">车库地址</label>
                                        <label class="layui-form-label-left-col-5"
                                               id="addressLabel"></label>
                                    </div>
                                    <div class="layui-form-item" style="margin-bottom: 0px;">
                                        <label class="layui-form-label-right-col-3">经纬度</label>
                                        <label class="layui-form-label-left-col-5" id="inglatLabel"></label>
                                    </div>
                                    <div class="layui-form-item" style="margin-bottom: 0px;">
                                        <label class="layui-form-label-right-col-3">管理员</label>
                                        <label class="layui-form-label-left-col-5" id="adminLabel"></label>
                                    </div>
                                    <div class="layui-form-item" style="margin-bottom: 0px;">
                                        <label class="layui-form-label-right-col-3">联系电话</label>
                                        <label class="layui-form-label-left-col-5" id="mobileLabel"></label>
                                    </div>

                                    <div class="layui-form-item" style="margin-bottom: 0px;">
                                        <label class="layui-form-label-right-col-3">微信绑定用户</label>
                                        <label class="layui-form-label-left-col-5">
                                            <a href="#" class="menu-btn active" title="点击查看微信用户详情" id="wxUserNum"> </a>
                                        </label>
                                    </div>
                                    <div class="layui-form-item" style="margin-bottom: 0px;">
                                        <label class="layui-form-label-right-col-3">创建时间</label>
                                        <label class="layui-form-label-left-col-5" id="createTime"></label>
                                    </div>
                                    <div class="layui-form-item" style="margin-bottom: 0px;">
                                        <label class="layui-form-label-right-col-3">门禁控制器数量</label>
                                        <label class="layui-form-label-left-col-5">
                                            <a href="#" class="menu-btn active" title="点击查看门禁详情"
                                               id="accessControlNum"> </a>
                                        </label>
                                    </div>
                                    <div style="text-align: center">
                                        <button type="button" class="layui-btn" id="garageMemoAddPageBtn">增加备忘录</button>
                                    </div>
                                </div>
                                <div class="layui-tab-item">
                                    <div class="layui-form-item" style="margin-top: 10px; margin-bottom: 0px;">
                                        <label class="layui-form-label-right-col-3">车位总数</label>
                                        <label class="layui-form-label-left-col-5"></label>
                                    </div>
                                    <div class="layui-form-item" style="margin-bottom: 0px;">
                                        <label class="layui-form-label-right-col-3">摩托车车位</label>
                                        <label class="layui-form-label-left-col-5"></label>
                                    </div>
                                    <div class="layui-form-item" style="margin-bottom: 0px;">
                                        <label class="layui-form-label-right-col-3">电动车车位</label>
                                        <label class="layui-form-label-left-col-5"></label>
                                    </div>
                                    <div class="layui-form-item" style="margin-bottom: 0px;">
                                        <label class="layui-form-label-right-col-3">三轮车车位</label>
                                        <label class="layui-form-label-left-col-5"></label>
                                    </div>
                                    <div class="layui-form-item" style="margin-bottom: 0px;">
                                        <label class="layui-form-label-right-col-3">自行车车位</label>
                                        <label class="layui-form-label-left-col-5"></label>
                                    </div>
                                    <div class="layui-form-item" style="margin-bottom: 0px;">
                                        <label class="layui-form-label-right-col-3">残疾车车位</label>
                                        <label class="layui-form-label-left-col-5"></label>
                                    </div>
                                    <div class="layui-form-item" style="margin-bottom: 0px;">
                                        <label class="layui-form-label-right-col-3">待定车位</label>
                                        <label class="layui-form-label-left-col-5"></label>
                                    </div>
                                    <div class="layui-form-item" style="margin-bottom: 0px;">
                                        <label class="layui-form-label-right-col-3">电动车车位</label>
                                        <label class="layui-form-label-left-col-5"></label>
                                    </div>
                                    <div class="layui-form-item" style="margin-bottom: 0px;">
                                        <label class="layui-form-label-right-col-3">报警用户车位</label>
                                        <label class="layui-form-label-left-col-5"></label>
                                    </div>
                                </div>
                                <div class="layui-tab-item">
                                    <div class="layui-form-item" style="margin-top: 10px; margin-bottom: 0px;">
                                        <label class="layui-form-label-right-col-3">车位</label>
                                        <label class="layui-form-label-left-col-5"></label>
                                    </div>
                                    <div class="layui-form-item" style="margin-bottom: 0px;">
                                        <label class="layui-form-label-right-col-3">充电站</label>
                                        <label class="layui-form-label-left-col-5"></label>
                                    </div>
                                    <div class="layui-form-item" style="margin-bottom: 0px;">
                                        <label class="layui-form-label-right-col-3">门禁</label>
                                        <label class="layui-form-label-left-col-5"></label>
                                    </div>
                                    <div class="layui-form-item" style="margin-bottom: 0px;">
                                        <label class="layui-form-label-right-col-3">监控</label>
                                        <label class="layui-form-label-left-col-5"></label>
                                    </div>
                                    <div style="text-align: center">
                                        <button type="button" class="layui-btn" id="deviceBtn">查看设备详情</button>
                                    </div>
                                    <div style="text-align: center; margin-top: 10px">
                                        <button type="button" class="layui-btn" title="增加车位" id="carPageBtn"><i
                                                class="fa fa-car"
                                                aria-hidden="true"></i>
                                        </button>
                                        <button type="button" class="layui-btn" title="增加充电站" id="garageChargerPageBtn">
                                            <i class="fa fa-bolt"
                                               aria-hidden="true"></i>
                                        </button>
                                        <button type="button" class="layui-btn" title="增加门禁" id="acAddPageBtn"><i
                                                class="fa fa-unlock-alt"
                                                aria-hidden="true"></i>
                                        </button>
                                        <button type="button" class="layui-btn" title="增加监控" id="cameraAddPageBtn"><i
                                                class="fa fa-video-camera" aria-hidden="true"></i></button>
                                    </div>
                                </div>
                                <div class="layui-tab-item">
                                    <div class="layui-form-item" style="text-align: center">
                                        <button type="button" class="layui-btn" title="远程开门"><i class="fa fa-key"
                                                                                                aria-hidden="true"></i>
                                        </button>
                                        <button type="button" class="layui-btn" title="监控"><i class="fa fa-video-camera"
                                                                                              aria-hidden="true"></i>
                                        </button>
                                        <button type="button" class="layui-btn" title="报警"><i class="fa fa-bell"
                                                                                              aria-hidden="true"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-col-md12" style="display: none">
                    <!--                    暂时不用-->
                    <div class="layui-inline">
                        <label class="layui-form-label">车库名称</label>
                        <div class="layui-input-block">
                            <input id="garageNameSearch" class="layui-input" type="text" placeholder="请输入"
                                   autocomplete="off">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <button type="button" class="layui-btn layuiadmin-btn-admin" lay-filter="LAY-user-back-search"
                                id="searchMaintainBtn">
                            <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
                        </button>
                    </div>
                </div>
                <div class="layui-col-md12" id="garageTable"
                     style="border: 1px solid #848d92;min-height: 100px; margin-right: 10px; margin-top: 10px;max-width: 97%">
                    <div class="" style="background-color: #848d92">车库列表</div>
                    <table style="margin: 10px" class="layui-hide" id="maintainTable"
                           lay-filter="maintainTable"></table>
                </div>

                <div class="layui-col-md12" id="maintainMomeDiv"
                     style="border: 1px solid #848d92;min-height: 100px; margin-right: 10px; margin-top: 10px;max-width: 97%; display: none">
                    <div class="" style="background-color: #848d92">备忘录</div>
                    <table class="layui-hide" id="maintainMomeTable" lay-filter="maintainMomeTable"></table>
                </div>
                <div id="deviceContent" class="layui-col-md12"
                     style="border: 1px solid #848d92;min-height: 100px; margin-right: 10px; margin-top: 10px;max-width: 97%; display: none">
                    <div style="background-color: #848d92" class="layui-col-md12">
                        <div class="layui-col-md11">设备信息</div>
                        <div class="layui-col-md1" style="text-align: right;">
                            <a class="layui-btn-xs" style="line-height: 20px;cursor: pointer;color: #ffffff"
                               lay-event="detail">
                                <i class="fa fa-times" aria-hidden="true" id="closeDeviceContent"
                                   style="font-size: 20px !important"></i>
                            </a>
                        </div>
                    </div>
                    <div class="layui-tab layui-col-md12" lay-filter="deviceDetails">
                        <ul class="layui-tab-title">
                            <li class="layui-this">车位</li>
                            <li>门禁</li>
                            <li>充电站</li>
                            <li>监控</li>
                        </ul>
                        <div class="layui-tab-content" id="parkingInfo">
                            <div class="layui-tab-item layui-show">
                                <table class="layui-hide" id="parkingSpaceTable" lay-filter="parkingSpaceTable"></table>
                            </div>
                            <div class="layui-tab-item">
                                <table class="layui-hide" id="accessTable" lay-filter="accessTable"></table>
                            </div>
                            <div class="layui-tab-item">
                                <table class="layui-hide" id="garageChargerTable"
                                       lay-filter="garageChargerTable"></table>
                            </div>
                            <div class="layui-tab-item">
                                <table class="layui-hide" id="cameraTable" lay-filter="cameraTable"></table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/html" id="parkingSpaceStatus">
    {{#  if(d.status === 0){ }}
    空闲
    {{#  } else if(d.status === 1) { }}
    故障
    {{#  } else if(d.status === 2) { }}
    保留
    {{#  } else if(d.status === 3) { }}
    已预约
    {{#  } else if(d.status === 4) { }}
    使用中
    {{#  } else if(d.status === 5) { }}
    冻结
    {{#  } else if(d.status === 6) { }}
    停卡
    {{#  } }}
</script>

<script type="text/html" id="ingAndLat">
    {{d.ing}}--{{d.lat}}
</script>

<script type="text/html" id="plugToolbar">
    {{#  if(d.addCharger === 1){ }}
    附加
    {{#  } else { }}
    不附加
    {{#  } }}
</script>

<script type="text/html" id="garageChargerThirdPayToolbar">
    {{#  if(d.thirdPay === 1){ }}
    支持
    {{#  } else { }}
    不支持
    {{#  } }}
</script>

<script type="text/html" id="garageChargerStatus">
    {{#  if(d.status === 1){ }}
    在线
    {{#  } else { }}
    离线
    {{#  } }}
</script>

<script type="text/html" id="garageBar">
    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="garageMemo">备忘录</a>
</script>

<script type="text/html" id="garageMomeBar">
    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
    <!--    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="edit">编辑</a>-->
    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="delete">删除</a>
</script>

<script type="text/html" id="cameraEditPage">
    <div class="container" style="width: 98%">
        <div class="layui-form">
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>监控新增</legend>
            </fieldset>
            <form class="layui-form layui-form-pane" id="cameraEditPageFrom" action="" lay-filter="camera-edit">
                <input type="hidden" id="cameraId" name="cameraId">
                <div class="layui-form-item">
                    <label class="layui-form-label">监控名称</label>
                    <div class="layui-input-block">
                        <input type="text" name="cameraName" autocomplete="off" id="cameraName"
                               placeholder="监控名称"
                               lay-reqtext="监控名称不能为空" lay-verify="required" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">监控类型</label>
                    <div class="layui-input-block">
                        <input type="text" name="cameraType" autocomplete="off" id="cameraType"
                               placeholder="监控类型"
                               lay-reqtext="监控类型不能为空" lay-verify="required" class="layui-input" value="1">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">监控ip</label>
                    <div class="layui-input-block">
                        <input type="text" name="ip" autocomplete="off" id="ip" placeholder="监控ip"
                               lay-reqtext="监控ip不能为空" lay-verify="required" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">监控端口</label>
                    <div class="layui-input-block">
                        <input type="text" name="port" autocomplete="off" id="port"
                               placeholder="监控端口"
                               lay-reqtext="监控端口不能为空" lay-verify="required" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">登录账号</label>
                    <div class="layui-input-block">
                        <input type="text" name="loginAccount" autocomplete="off" id="loginAccount"
                               placeholder="登录账号"
                               lay-reqtext="登录账号不能为空" lay-verify="required" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">登录密码</label>
                    <div class="layui-input-block">
                        <input type="text" name="password" autocomplete="off" id="password"
                               placeholder="登录密码"
                               lay-reqtext="登录密码不能为空" lay-verify="required" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">安装地址</label>
                    <div class="layui-input-block">
                        <input type="text" name="installAddress" autocomplete="off" id="installAddress"
                               placeholder="安装地址"
                               lay-reqtext="安装地址不能为空" lay-verify="required" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn" lay-submit="" type="button" lay-filter="cameraFormSubmit">立即提交
                        </button>
                        <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</script>

<script type="text/html" id="accessControllerEditPage">
    <div class="container" style="width: 98%">
        <div class="layui-form">
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>新增门禁</legend>
            </fieldset>
            <form class="layui-form layui-form-pane" id="accessControllerEditPageForm" action=""
                  lay-filter="access_controller-edit">
                <input type="hidden" id="acId" name="acId">
                <div class="layui-form-item">
                    <label class="layui-form-label">控制器类型</label>
                    <div class="layui-input-block">
                        <input type="text" name="acType" autocomplete="off" id="acType"
                               placeholder="控制器类型"
                               lay-reqtext="控制器类型不能为空" lay-verify="required" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">产品序列号</label>
                    <div class="layui-input-block">
                        <input type="text" name="acSn" autocomplete="off" id="acSn"
                               placeholder="产品序列号"
                               lay-reqtext="产品序列号不能为空" lay-verify="required" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">IP地址</label>
                    <div class="layui-input-block">
                        <input type="text" name="acIp" autocomplete="off" id="acIp" placeholder="IP地址"
                               lay-reqtext="IP地址不能为空" lay-verify="required" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">端口</label>
                    <div class="layui-input-block">
                        <input type="text" name="acPort" autocomplete="off" id="acPort"
                               placeholder="端口"
                               lay-reqtext="端口不能为空" lay-verify="required" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">mac地址</label>
                    <div class="layui-input-block">
                        <input type="text" name="acMac" autocomplete="off" id="acMac"
                               placeholder="mac地址"
                               lay-reqtext="mac地址不能为空" lay-verify="required" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">子网掩码</label>
                    <div class="layui-input-block">
                        <input type="text" name="mask" autocomplete="off" id="mask"
                               placeholder="子网掩码"
                               lay-reqtext="子网掩码不能为空" lay-verify="required" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">网关</label>
                    <div class="layui-input-block">
                        <input type="text" name="gateway" autocomplete="off" id="gateway"
                               placeholder="网关"
                               lay-reqtext="网关不能为空" lay-verify="required" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">说明</label>
                    <div class="layui-input-block">
                        <input type="text" name="remark" autocomplete="off" id="remark"
                               placeholder="网关"
                               lay-reqtext="网关不能为空" lay-verify="required" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn" lay-submit="" type="button" lay-filter="acFormSubmit">立即提交</button>
                        <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</script>

<script type="text/html" id="carEditPage">
    <div class="container" style="width: 98%">
        <div class="layui-form">
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>新增车位</legend>
            </fieldset>
            <form class="layui-form layui-form-pane" id="carPageForm" action="" lay-filter="car-edit">
                <input type="hidden" id="spaceId" name="spaceId">
                <div class="layui-form-item">
                    <label class="layui-form-label">车库类型</label>
                    <div class="layui-input-block">
                        <select name="thirdPay" id="spaceType" lay-verify="spaceType">
                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">添加数量</label>
                    <div class="layui-input-block">
                        <input type="text" name="addCount" autocomplete="off" id="addCount"
                               placeholder="添加数量"
                               lay-reqtext="添加数量不能为空" lay-verify="required" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn" lay-submit="" type="button" lay-filter="carFormSubmit">立即提交</button>
                        <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</script>

<script type="text/html" id="garageChargerEditPage">
    <div class="container" style="width: 98%">
        <div class="layui-form">
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>新增充电站</legend>
            </fieldset>
            <form class="layui-form layui-form-pane" id="garageChargerPageForm" action=""
                  lay-filter="garage-charger-edit">
                <input type="hidden" id="chargerId" name="chargerId">
                <div class="layui-form-item">
                    <label class="layui-form-label">名称</label>
                    <div class="layui-input-block">
                        <input type="text" name="chargerName" autocomplete="off" id="chargerName"
                               placeholder="充电站名称"
                               lay-reqtext="充电站名称不能为空" lay-verify="required" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">序列号</label>
                    <div class="layui-input-block">
                        <input type="text" name="gcSn" autocomplete="off" id="gcSn"
                               placeholder="序列号"
                               lay-reqtext="产品序列号不能为空" lay-verify="required" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">三方支付</label>
                    <div class="layui-input-block">
                        <select name="thirdPay" id="thirdPay" lay-verify="required">
                            <option value="1">是</option>
                            <option value="0">否</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">当前版本</label>
                    <div class="layui-input-block">
                        <input type="number" name="currentVersion" autocomplete="off" id="currentVersion"
                               placeholder="当前版本"
                               lay-reqtext="当前版本不能为空" lay-verify="required" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn" lay-submit="" type="button" lay-filter="garageChargerFormSubmit">
                            立即提交
                        </button>
                        <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</script>

<!-- js插件 -->
<script src="../../vendor/jquery/jquery.min.js"></script>
<script src="../../vendor/layui/layui.js" charset="utf-8"></script>
<!-- js公共代码 -->
<script src="../../js/common.js"></script>
<script src="../../js/front.js"></script>

<script type="text/javascript"
        src="http://api.map.baidu.com/api?v=2.0&ak=GbQ9Fn1S6DwGf4nAjXwrN9vLVEfKrT2V"></script>
<script>
    var maintainInfo;
    layui.use(['tree', 'util', 'table', 'element', 'upload', 'form', 'layedit', 'laydate'], function () {
        var tree = layui.tree
            , layer = layui.layer
            , table = layui.table
            , element = layui.element
            , $ = layui.jquery
            , form = layui.form
            , layedit = layui.layedit
            , laydate = layui.laydate;

        // 百度地图API功能
        var map = new BMap.Map("allmap");
        var point = new BMap.Point(119.98186101, 31.77139674);
        map.centerAndZoom(point, 15);
        map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放
        var marker = new BMap.Marker(new BMap.Point(119.98186101, 31.77139674));
        map.addOverlay(marker);

        var spaceTypeList;

        sendAjaxRequest("POST", "/getParkingSpaceTypeList.json", "json", {}, function (res) {
            if (res.resFlag === 'N') {
                if (res.parkingSpaceTypeList) {
                    spaceTypeList = res.parkingSpaceTypeList;
                }
            } else {
                layer.msg("查询失败");
            }
        }, function () {
            layer.msg("查询失败");
        });

        //列表搜索按钮
        $("#searchMaintainBtn").click(function (event) {
            tableReload(tableIns);
        });

        //监控新增监听提交
        form.on('submit(cameraFormSubmit)', function () {
            var data = $("#cameraEditPageFrom").serializeObject();
            var url = "/cameraAdd.json";
            if (data.id) {
                data.id = parseInt(data.id)
                url = "/cameraUpdate.json";
            }
            data.port = parseInt(data.port);
            data.cameraType = parseInt(data.cameraType);
            data.garageId = parseInt(maintainInfo.garageId);
            sendAjaxRequest("POST", url, "json", JSON.stringify(data), function (res) {
                if (res.resFlag === 'N') {
                    layer.msg("保存成功");
                    noPageTableReload(cameraTableIns, {garageId: maintainInfo.garageId});
                    layer.closeAll();
                } else {
                    layer.msg("保存失败");
                }
            }, function () {
                layer.msg("操作失败");
            });
            return false;
        });

        //新增门禁监听提交
        form.on('submit(acFormSubmit)', function () {
            var data = $("#accessControllerEditPageForm").serializeObject();
            var url = "accessControllerAdd.json";
            if (data.id) {
                data.id = parseInt(data.id)
                url = "accessControllerUpdate.json";
            }
            data.port = parseInt(data.acPort);
            data.acType = parseInt(data.acType);
            data.garageId = parseInt(maintainInfo.garageId);

            data.sn = data.acSn;
            data.ip = data.acIp;
            data.mac = data.acMac;

            sendAjaxRequest("POST", url, "json", JSON.stringify(data), function (res) {
                if (res.resFlag === 'N') {
                    layer.msg("保存成功");
                    noPageTableReload(accessTableIns, {garageId: maintainInfo.garageId});
                    layer.closeAll();
                } else {
                    layer.msg("保存失败");
                }
            }, function () {
                layer.msg("操作失败");
            });
            return false;
        });

        //车位监听提交
        form.on('submit(carFormSubmit)', function () {
            var data = $("#carPageForm").serializeObject();
            var url = "parkingSpaceAdd.json";
            if (data.id) {
                data.id = parseInt(data.id)
                url = "parkingSpaceUpdate.json";
            }
            data.spaceType = parseInt(data.spaceType);
            data.addCount = parseInt(data.addCount);
            data.garageId = parseInt(maintainInfo.garageId);

            sendAjaxRequest("POST", url, "json", JSON.stringify(data), function (res) {
                if (res.resFlag === 'N') {
                    layer.msg("保存成功");
                    noPageTableReload(parkingSpaceTableIns, {garageId: maintainInfo.garageId});
                    layer.closeAll();
                } else {
                    layer.msg("保存失败");
                }
            }, function () {
                layer.msg("操作失败");
            });
            return false;
        });

        //新增充电站监听提交
        form.on('submit(garageChargerFormSubmit)', function () {
            var data = $("#garageChargerPageForm").serializeObject();
            var url = "garageChargerAdd.json";
            if (data.id) {
                data.id = parseInt(data.id)
                url = "garageChargerUpdate.json";
            }
            data.currentVersion = parseInt(data.currentVersion);
            data.thirdPay = parseInt(data.thirdPay);
            data.garageId = parseInt(maintainInfo.garageId);
            data.chargerId = parseInt(data.chargerId);
            data.sn = data.gcSn;
            sendAjaxRequest("POST", url, "json", JSON.stringify(data), function (res) {
                if (res.resFlag === 'N') {
                    layer.msg("保存成功");
                    noPageTableReload(parkingSpaceTableIns, {garageId: maintainInfo.garageId});
                    layer.closeAll();
                } else {
                    layer.msg("保存失败");
                }
            }, function () {
                layer.msg("操作失败");
            });
            return false;
        });

        //监控页面
        $("#cameraAddPageBtn").click(function (event) {
            layer.open({
                type: 1
                , title: false //不显示标题栏
                , area: ['500px', '600px']
                , id: 'lay-cameraAddPageBtn' //设定一个id，防止重复弹出
                , content: $("#cameraEditPage").html()
            });
            form.render();
        });

        //门禁页面
        $("#acAddPageBtn").click(function (event) {
            layer.open({
                type: 1
                , title: false //不显示标题栏
                , area: ['500px', '650px']
                , id: 'lay-acAddPageBtn' //设定一个id，防止重复弹出
                , content: $("#accessControllerEditPage").html()
            });
            form.render();
        });

        ////车位页面
        $("#carPageBtn").click(function (event) {
            layer.open({
                type: 1
                , title: false //不显示标题栏
                , area: ['500px', '300px']
                , id: 'lay-carPageBtn' //设定一个id，防止重复弹出
                , content: $("#carEditPage").html()
            });
            for (var i = 0; i < spaceTypeList.length; i++) {
                var spaceType = spaceTypeList[i];
                $("#spaceType").append("<option value=" + spaceType.id + ">" + spaceType.name + "</option>")
            }
            form.render();
        });

        //充电桩页面
        $("#garageChargerPageBtn").click(function (event) {
            layer.open({
                type: 1
                , title: false //不显示标题栏
                , area: ['500px', '500px']
                , id: 'lay-garageChargerPageBtn' //设定一个id，防止重复弹出
                , content: $("#garageChargerEditPage").html()
            });
            form.render();
        });

        //关闭设备信息，显示车库信息
        $("#closeDeviceContent").click(function (event) {
            $("#deviceContent").hide();
            $("#garageTable").show();
        })

        //关闭车库信息,显示设备信息
        $("#deviceBtn").click(function (event) {
            $("#garageTable").hide();
            $("#maintainMomeDiv").hide();
            $("#deviceContent").show();
            tableReload(parkingSpaceTableIns, {garageId: maintainInfo.garageId})
        });

        $("#parkingInfo li").click(function () {
            $("#parkingInfo li").removeClass("active");
            $(this).addClass("active");
        });

        $("#garageMemoAddPageBtn").click(function (event) {
            layer.prompt({title: '增加车库备忘录', formType: 2}, function (text, index) {
                layer.close(index);
                saveGarageMemoBtn({
                    "garageId": maintainInfo.garageId,
                    "content": text,
                    "orgId": maintainInfo.orgId
                });
            });
        });


        //增加备忘录
        function saveGarageMemoBtn(content) {
            if (content) {
                var url = "/garageMemoAdd.json";
                if (content.id) {
                    url = "/garageMemoUpdate.json";
                }
                sendAjaxRequest("POST", url, "json", JSON.stringify(content), function (res) {
                    if (res.resFlag === 'N') {
                        layer.msg("保存成功");
                        tableReload(momeTableIns, {garageId: maintainInfo.garageId})
                    } else {
                        layer.msg("保存失败");
                    }
                }, function () {
                    layer.msg("操作失败");
                });
            } else {
                layer.msg("请填写备注")
            }
        }

        var garageListCols = [[
            {type: 'numbers', title: '序号', width: 80, fixed: 'center'},
            {
                field: 'garageName', title: '车库名称', sort: false, fixed: 'center'
            },
            {
                field: 'userId', title: '经纬度', toolbar: "#ingAndLat", sort: false, fixed: 'center'
            },
            {
                field: 'mobile', title: '联系方式', sort: false, fixed: 'center'
            },
            {
                field: 'userId', title: '车位申请', width: 100, sort: false, fixed: 'center'
            },
            {
                field: 'userId', title: '微信数', width: 80, sort: false, fixed: 'center'
            },
            {
                field: 'createTime', title: '创建时间', sort: false, fixed: 'center'
            },
            {
                field: 'userId', title: '操作', width: 160, toolbar: "#garageBar", sort: false, fixed: 'center'
            }
        ]];

        function res(res) {
            return {
                code: 0,
                msg: "",
                count: res.records,
                data: res.rows
            };
        }

        function garageListdone(res, curr, count) {
            //如果是异步请求数据方式，res即为你接口返回的信息。
            //如果是直接赋值的方式，res即为：{data: [], count: 99} data为当前页数据、count为数据总长度
            if (res.data) {
                if (res.data[0]) {
                    maintainInfo = res.data[0];
                    map.clearOverlays();
                    setTimeout(function () {
                        for (var i = 0; i < res.data.length; i++) {
                            theLocation(res.data[i].ing, res.data[i].lat, true, res.data[i].garageName, res.data[i].address)
                        }
                    }, 100);
                    showMaintain(res.data[0], true);
                    // tableReload(momeTableIns, {garageId: res.data[0].garageId})
                } else {
                    $("#maintainInfoDetails").hide();
                    $("#maintainMapInfo").css("min-width", "97%");
                }
            }
        }

        var tableIns = initTable(table, null, "maintainTable", 20, "/getGarageList.json", {orgId: 0}, res, garageListCols, null, garageListdone);


        var maintainMomeCols = [[
            {type: 'numbers', title: '序号', width: 80, fixed: 'center'},
            {
                field: 'userName', title: '操作者', sort: false, fixed: 'center'
            },
            {
                field: 'createTime', title: '创建时间', sort: false, fixed: 'center'
            },
            {
                field: 'garageName', title: '车库名称', sort: false, fixed: 'center'
            },
            {
                field: 'content', title: '备注内容', sort: false, fixed: 'center'
            },
            {
                field: 'memoId', title: '操作', toolbar: "#garageMomeBar", sort: false, fixed: 'center'
            }
        ]];

        var momeTableIns = initTable(table, null, "maintainMomeTable", 20, "/getGarageMemoListByGarage.json", {garageId: -1}, res, maintainMomeCols, null, null);


        function accessRes(res) {
            return {
                code: 0,
                msg: "",
                count: res.records,
                data: res.accessControllerInfoList
            };
        }

        var accessCols = [[
            {type: 'numbers', title: '序号', width: 80, fixed: 'center'},
            {
                field: 'sn', title: '产品序列号', sort: false, fixed: 'center'
            },
            {
                field: 'ip', title: 'IP地址', sort: false, fixed: 'center'
            },
            {
                field: 'port', title: '端口', sort: false, fixed: 'center'
            }
        ]];

        var accessTableIns = initNotPageTable(table, "accessTable", "/getAccessControllerList.json", {garageId: -1}, accessRes, accessCols, null);


        function parkingSpaceRes(res) {
            return {
                code: 0,
                msg: "",
                count: res.records,
                data: res.rows
            };
        }

        var parkingSpaceCols = [[
            {type: 'numbers', title: '序号', width: 80, fixed: 'center'},
            {
                field: 'spaceName', title: '车位名称', sort: false, fixed: 'center'
            },
            {
                field: 'spaceTypeName', title: '车位类别', sort: false, fixed: 'center'
            },
            {
                field: 'status', title: '车位状态', toolbar: "#parkingSpaceStatus", sort: false, fixed: 'center'
            },
            {
                field: 'addCharger', title: '充电站插头', toolbar: "#plugToolbar", sort: false, fixed: 'center'
            }
        ]];
        var parkingSpaceTableIns = initTable(table, null, "parkingSpaceTable", 20, "/getParkingSpaceList.json", {garageId: -1}, parkingSpaceRes, parkingSpaceCols, null, null);


        function garageChargerRes(res) {
            return {
                code: 0,
                msg: "",
                count: res.records,
                data: res.garageChargerInfoList
            };
        }

        var garageChargerCols = [[
            {type: 'numbers', title: '序号', width: 80, fixed: 'center'},

            {
                field: 'chargerName', title: '充电站名称', sort: false, fixed: 'center'
            },
            {
                field: 'sn', title: '产品序列号', sort: false, fixed: 'center'
            },
            {
                field: 'status', title: '设备状态', toolbar: "#garageChargerStatus", sort: false, fixed: 'center'
            },
            {
                field: 'currentVersion', title: '当前版本', sort: false, fixed: 'center'
            },
            {
                field: 'thirdPay',
                title: '是否支持第三方支付',
                toolbar: "#garageChargerThirdPayToolbar",
                sort: false,
                fixed: 'center'
            },
            {
                field: 'createTime', title: '创建时间', sort: false, fixed: 'center'
            },
        ]];
        var garageChargerTableIns = initTable(table, null, "garageChargerTable", 20, "/getGarageChargerList.json", {garageId: -1}, garageChargerRes, garageChargerCols, null, null);

        var cameraCols = [[
            {type: 'numbers', title: '序号', width: 80, fixed: 'center'},

            {
                field: 'cameraName', title: '监控名称', sort: false, fixed: 'center'
            },
            {
                field: 'cameraType', title: '监控类型', sort: false, fixed: 'center'
            },
            {
                field: 'ip', title: '监控ip', sort: false, fixed: 'center'
            },
            {
                field: 'loginAccount', title: '登录账号', sort: false, fixed: 'center'
            },
            {
                field: 'installAddress', title: '安装地址描述', sort: false, fixed: 'center'
            },
            {
                field: 'status', title: '状态', sort: false, fixed: 'center'
            },
        ]];

        function cameraRes(res) {
            return {
                code: 0,
                msg: "",
                data: res.cameraInfoList
            };
        }

        var cameraTableIns = initNotPageTable(table, "cameraTable", "/getCameraList.json", {garageId: -1}, cameraRes, cameraCols, null);


        function showMaintain(maintainInfo, locationFlag) {
            $("#garageNameLabel").html(maintainInfo.garageName);//车库名称
            $("#orgIdLabel").html(maintainInfo.orgId);//所属机构id
            $("#inglatLabel").html(maintainInfo.ing + "--" + maintainInfo.lat);//经度
            $("#addressLabel").html(maintainInfo.address);//地址
            $("#adminLabel").html(maintainInfo.admin);//车库管理员
            $("#mobileLabel").html(maintainInfo.mobile);//联系方式
            $("#wxUserNum").html("微信用户数量");//微信用户数量
            $("#createTime").html(maintainInfo.createTime);//创建时间
            $("#accessControlNum").html("门禁数量");//门禁数量
            if (locationFlag) {
                theLocation(maintainInfo.ing, maintainInfo.lat, false, maintainInfo.garageName, maintainInfo.address);
            }
            $("#maintainInfoDetails").show();
            $("#maintainMapInfo").css("min-width", "65%");
        }

        // 用经纬度设置地图中心点
        function theLocation(longitude, latitude, addFlag, name, address) {
            if (longitude != "" && latitude != "") {
                var new_point = new BMap.Point(longitude, latitude);
                map.centerAndZoom(new_point, 15);
                var marker = new BMap.Marker(new_point);  // 创建标注
                if (addFlag) {
                    map.addOverlay(marker);              // 将标注添加到地图中
                    var opts = {
                        width: 200,     // 信息窗口宽度
                        height: 100,     // 信息窗口高度
                        title: name // 信息窗口标题
                    }
                    var infoWindow = new BMap.InfoWindow("地址：" + address, opts);  // 创建信息窗口对象
                    marker.addEventListener("click", function () {
                        map.openInfoWindow(infoWindow, new_point); //开启信息窗口
                    });
                }
                map.panTo(new_point);
            }
        }

        initTree(tree, '#orgTree', "/getOrgTree.json", JSON.stringify({"orgId": 1}), clickOrg)

        function clickOrg(orgInfo) {
            tableReload(tableIns, {orgId: orgInfo.data.id})

            if (orgInfo.data.level === 3) {
                map.clearOverlays();
                $("#maintainInfoDetails").show();
                // $("#maintainMomeDiv").show();
                $("#maintainMapInfo").css("min-width", "65%");
                $("#garageTable").show();
                $("#deviceContent").hide();
            } else {
                map.clearOverlays();
                $("#maintainInfoDetails").hide();
                $("#maintainMomeDiv").hide();
                $("#garageTable").show();
                $("#deviceContent").hide();
                $("#maintainMapInfo").css("min-width", "97%");
            }
        }

        //监听行工具事件
        table.on('tool(maintainTable)', function (obj) {
            var data = obj.data;
            if (obj.event === 'detail') {
                maintainInfo = data;
                showMaintain(data, true)
                $("#editMaintainForm").hide();
                $("#showMaintain").show()
            } else if (obj.event === 'garageMemo') {
                $("#maintainMomeDiv").show();
                tableReload(momeTableIns, {garageId: data.garageId})
            }
        });

        //监听设备详情中选项卡
        element.on('tab(deviceDetails)', function (data) {
            if (data.index === 1) {
                noPageTableReload(accessTableIns, {garageId: maintainInfo.garageId});
            } else if (data.index === 2) {
                tableReload(garageChargerTableIns, {garageId: maintainInfo.garageId});
            } else if (data.index === 3) {
                noPageTableReload(cameraTableIns, {garageId: maintainInfo.garageId});
            }
        });


        //监听行工具事件
        table.on('tool(maintainMomeTable)', function (obj) {
            var data = obj.data;
            if (obj.event === 'detail') {
                layer.alert(data.content)
            } else if (obj.event === 'edit') {
                layer.prompt({title: '修改备注', formType: 2, value: data.content}, function (text, index) {
                    layer.close(index);
                    var content = {
                        "memoId": data.memoId,
                        "garageId": data.garageId,
                        "content": text,
                        "orgId": data.orgId
                    };
                    saveGarageMemoBtn(content);
                });
            } else if (obj.event === 'delete') {
                var data = {memoId: data.memoId};
                layer.confirm('真的删除行么', function (index) {

                    sendAjaxRequest("POST", "/garageMemoDelete.json", "json", JSON.stringify(data), function (res) {
                        if (res.resFlag === 'N') {
                            tableReload(momeTableIns, {garageId: maintainInfo.garageId})
                            layer.msg("删除成功");
                        } else {
                            layer.msg("删除失败");
                        }
                    }, function () {
                        layer.msg("删除失败");
                    });
                    layer.close(index);
                });
            }
        });
    });
</script>
</body>

</html>
